WEBVTT
Kind: captions
Language: en

00:00:00.300 --> 00:00:02.680
So the developer and
I have written all of these rules.

00:00:02.680 --> 00:00:05.460
Good job by the way, and
the rules are in the app.

00:00:05.460 --> 00:00:07.740
&gt;&gt; Well that's a load off my
shoulders while I get packed.

00:00:07.740 --> 00:00:09.830
&gt;&gt; Wait up.
You didn't let me finish my sentence.

00:00:09.830 --> 00:00:12.296
All of your hulabaloo about
security has me paranoid.

00:00:12.296 --> 00:00:14.848
&gt;&gt; You're welcome.

00:00:14.848 --> 00:00:15.364
&gt;&gt; Mm.

00:00:15.364 --> 00:00:16.250
&gt;&gt; Okay.
Okay.

00:00:16.250 --> 00:00:18.230
I guess it is my fault you're
on this security kick.

00:00:18.230 --> 00:00:19.640
What's the problem?

00:00:19.640 --> 00:00:21.910
&gt;&gt; Here I'll walk you through it.

00:00:21.910 --> 00:00:25.990
Our decision to use email as the key for
the user is causing a lot of issues.

00:00:25.990 --> 00:00:30.165
This boils down to the fact that
the only secure and verified method for

00:00:30.165 --> 00:00:34.425
knowing who a person is in the security
rules, is using the off dot UID.

00:00:34.425 --> 00:00:38.050
You don't automatically have any sort
of email associated with the account.

00:00:38.050 --> 00:00:42.080
And this is of course why we made
our mapping node from UID to email.

00:00:42.080 --> 00:00:47.090
Unfortunately, this connection here
is a very hard thing to secure.

00:00:47.090 --> 00:00:48.640
Let me walk you through an example.

00:00:48.640 --> 00:00:50.140
So, we have our hacker here.

00:00:50.140 --> 00:00:53.690
She has no sort of special permissions
to access our Firebase app.

00:00:53.690 --> 00:00:55.650
But she is JavaScript and
Firebase savvy,

00:00:55.650 --> 00:00:59.770
so she could execute some arbitrary
JavaScript code on our app.

00:00:59.770 --> 00:01:02.850
And she could write pretty much
any JavaScript code that she likes

00:01:02.850 --> 00:01:06.160
as long as our database rules permit
her to either do the read or the right.

00:01:06.160 --> 00:01:08.130
So let's take a look at the rules
that we have right now for

00:01:08.130 --> 00:01:09.200
the UID mapping node.

00:01:10.490 --> 00:01:14.770
Our rules say that anyone logged in can
read a single UID from the UID mappings

00:01:14.770 --> 00:01:18.590
node and if you are the user
who's associated with that node,

00:01:18.590 --> 00:01:19.980
you can write data to it.

00:01:19.980 --> 00:01:22.270
As long as you're adding data for
the first time.

00:01:22.270 --> 00:01:25.710
And we further have a validate rule
just to make sure that the value is

00:01:25.710 --> 00:01:27.860
in the form of the encoded email.

00:01:27.860 --> 00:01:28.580
Okay.

00:01:28.580 --> 00:01:32.930
So the first thing that our hacker could
do is execute a create account command.

00:01:32.930 --> 00:01:35.480
The first issue that
I'm seeing here is that

00:01:35.480 --> 00:01:37.760
since she's doing this
outside of our Android app.

00:01:37.760 --> 00:01:40.750
She could basically bypass
that whole nice reset password

00:01:40.750 --> 00:01:42.560
logon flow that we have.

00:01:42.560 --> 00:01:45.720
So there's nothing that's really forcing
her to prove that she actually owns

00:01:45.720 --> 00:01:47.720
the email that she claims that she owns.

00:01:47.720 --> 00:01:49.750
But she calls this create user command.

00:01:49.750 --> 00:01:51.020
And this should work.

00:01:51.020 --> 00:01:54.110
The Firebase backend will
return to her a you UID.

00:01:54.110 --> 00:01:57.890
So now she has a UID that she
has legitimate access to.

00:01:57.890 --> 00:02:02.410
So, here's a sample of a UID mappings
table, and the question is, is there

00:02:02.410 --> 00:02:07.210
anything in the rules that stops the
hacker from making an entry like this?

00:02:07.210 --> 00:02:11.480
Basically an entry where she uses
the legitimate UID that she got for

00:02:11.480 --> 00:02:15.340
herself and then associates it
with some email such as my email.

00:02:16.370 --> 00:02:17.540
&gt;&gt; No I guess not.

00:02:17.540 --> 00:02:20.680
After all the only rule is that
they're adding an entry associate with

00:02:20.680 --> 00:02:23.300
their own user and that's a new entry.

00:02:23.300 --> 00:02:26.680
So yes, that seems bad, but
what does it mean for the app?

00:02:26.680 --> 00:02:29.640
&gt;&gt; It means terrible, terrible things.

00:02:29.640 --> 00:02:31.420
Here, let's take a look at the database.

00:02:31.420 --> 00:02:34.050
Literally every rule trusts
that the UID mapping

00:02:34.050 --> 00:02:36.760
tells you what email
the UID is associated with.

00:02:36.760 --> 00:02:40.510
So if we can hack that mapping it
essentially gives our hacker complete

00:02:40.510 --> 00:02:43.180
access to all of my shopping lists.

00:02:43.180 --> 00:02:45.240
And that's a pretty major issue.

00:02:45.240 --> 00:02:48.090
So again,
issue number one is that there's

00:02:48.090 --> 00:02:51.190
not really a real way to
enforce our reset login flow

00:02:51.190 --> 00:02:55.470
if somebody is executing code outside of
the Shopping List plus plus Android app.

00:02:55.470 --> 00:02:59.930
And issue number two is that with
just a little bit of JavaScript code

00:02:59.930 --> 00:03:02.340
a hacker could easily
impersonate another user.

00:03:02.340 --> 00:03:06.193
And that's because our UID mappings
table is currently insecure and

00:03:06.193 --> 00:03:07.988
it's actually pretty tricky or

00:03:07.988 --> 00:03:11.258
potentially impossible to
secure in our security rules.

00:03:11.258 --> 00:03:13.847
&gt;&gt; And you're launching version .5 when?

00:03:13.847 --> 00:03:14.426
&gt;&gt; In a week.

00:03:14.426 --> 00:03:16.356
[SOUND]
&gt;&gt; Sweet Nexus that's my ride

00:03:16.356 --> 00:03:17.550
to the airport.

00:03:17.550 --> 00:03:18.590
Okay, I'll tell you what.

00:03:18.590 --> 00:03:20.510
I think I can ask Puff to chat with you.

00:03:20.510 --> 00:03:23.310
He's actually in the SF office today and
might be able to swing by your office.

00:03:24.430 --> 00:03:26.410
Well, that's actually
incredibly convenient.

00:03:26.410 --> 00:03:29.254
And my cribbage match got
rescheduled so, awesome.

00:03:29.254 --> 00:03:30.850
&gt;&gt; Well then I'll tell
him to take the company.

00:03:30.850 --> 00:03:33.348
Two person man experimental
flying electric vehicle.

00:03:33.348 --> 00:03:34.143
&gt;&gt; Excellent.

00:03:34.143 --> 00:03:36.010
Thanks JP and safe travels.

